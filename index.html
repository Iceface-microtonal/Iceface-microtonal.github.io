<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iceface Tuning (black keys +50c) | å…¬å¼å®šç¾©ã¨ãƒ‡ãƒ¢</title>

  <!-- åŸºæœ¬SEO -->
  <link rel="canonical" href="https://iceface-microtonal.github.io/">
  <meta name="description" content="Iceface Tuning ã¯12å¹³å‡å¾‹ã‚’åŸºã«é»’éµã®ã¿ã‚’ +50 ã‚»ãƒ³ãƒˆä¸Šã’ã‚‹ç‹¬è‡ªèª¿å¾‹ã€‚ç™½éµã¯é€šå¸¸ã®12å¹³å‡å¾‹ã€é»’éµã§å¾®åˆ†éŸ³çš„ãªå½©ã‚Šã‚’å¾—ã‚‰ã‚Œã¾ã™ã€‚ã‚»ãƒ³ãƒˆå€¤: 0,150,200,350,400,500,650,700,850,900,1050,1100,1200ã€‚ãƒ‡ãƒ¢å†…è”µã€‚">
  <meta name="robots" content="index,follow">
  <meta name="theme-color" content="#2c3e50">

  <!-- OGP / Twitter -->
  <meta property="og:type" content="website">
  <meta property="og:locale" content="ja_JP">
  <meta property="og:title" content="Iceface Tuning (black keys +50c)">
  <meta property="og:description" content="é»’éµã®ã¿ã‚’ +50 ã‚»ãƒ³ãƒˆä¸Šã’ã‚‹ç‹¬è‡ªèª¿å¾‹ã€‚å…¬å¼å®šç¾©ãƒ»ã‚»ãƒ³ãƒˆå€¤ãƒ»ãƒ‡ãƒ¢ã‚’æ²è¼‰ã€‚">
  <meta property="og:url" content="https://iceface-microtonal.github.io/">
  <meta property="og:image" content="https://iceface-microtonal.github.io/ogp.jpg"><!-- TODO: ç”»åƒã‚’ç”¨æ„ã§ããŸã‚‰å·®ã—æ›¿ãˆ -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Iceface Tuning (black keys +50c)">
  <meta name="twitter:description" content="é»’éµã®ã¿ +50 ã‚»ãƒ³ãƒˆã€‚12å¹³å‡å¾‹ã«è‡ªç„¶ã«å¾®åˆ†éŸ³ã‚’èåˆã€‚">
  <meta name="twitter:image" content="https://iceface-microtonal.github.io/ogp.jpg"><!-- TODO -->

  <style>
    /* æ—¢å­˜ã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯ãã®ã¾ã¾ï¼ˆç•¥ï¼‰ */
    body {
      font-family: 'Helvetica Neue', sans-serif;
      background: #f0f0f0;
      color: #333;
      line-height: 1.7;
      padding: 3em;
      max-width: 960px;
      margin: auto;
    }
    h1, h2 { color: #2c3e50; }
    a { color: #2980b9; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .section { margin-bottom: 3em; }
    footer { margin-top: 5em; text-align: center; color: #888; font-size: 0.9em; }
    /* Piano Player Stylesï¼ˆæ—¢å­˜ï¼‰ */
    .piano-player { background:#fff;border-radius:8px;padding:2em;margin:2em 0;box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    .piano-keyboard { display:flex;justify-content:center;margin:2em 0;position:relative;height:200px;overflow-x:auto;padding:0 10px; }
    .key { cursor:pointer;border:1px solid #ccc;display:flex;align-items:flex-end;justify-content:center;font-size:16px;font-weight:bold;user-select:none;transition:all .1s ease;touch-action:manipulation; }
    .key.white { background:#fff;width:70px;height:200px;color:#666;padding-bottom:15px; }
    .key.black { background:#333;width:50px;height:130px;color:#fff;margin-left:-25px;margin-right:-25px;z-index:2;position:relative;padding-bottom:15px; }
    @media (max-width:768px){ body{padding:1.5em;} .piano-keyboard{height:220px;margin:1em 0;} .key.white{width:65px;height:220px;font-size:16px;padding-bottom:15px;} .key.black{width:45px;height:145px;margin-left:-22.5px;margin-right:-22.5px;font-size:14px;padding-bottom:12px;} .piano-player{padding:1.5em;} }
    @media (max-width:480px){ body{padding:1em;} .piano-keyboard{height:240px;overflow-x:scroll;-webkit-overflow-scrolling:touch;} .key.white{width:60px;height:240px;font-size:15px;padding-bottom:15px;min-width:60px;} .key.black{width:42px;height:160px;margin-left:-21px;margin-right:-21px;font-size:13px;padding-bottom:12px;min-width:42px;} .piano-player{padding:1em;} .control-group label{width:80px;font-size:14px;} input[type="range"]{width:150px;} button{padding:12px 18px;font-size:14px;margin:8px 4px;} }
    @media (max-width:360px){ .piano-keyboard{height:260px;} .key.white{width:55px;height:260px;font-size:14px;} .key.black{width:38px;height:175px;margin-left:-19px;margin-right:-19px;font-size:12px;} }
    .key.ice { background:linear-gradient(to bottom,#e3f2fd,#90caf9); color:#1565c0; box-shadow:0 0 8px rgba(33,150,243,.3); }
    .key:hover{ transform:translateY(2px); }
    .key.active{ transform:translateY(4px); box-shadow:inset 0 2px 4px rgba(0,0,0,.3); }
    .controls{text-align:center;margin:2em 0;}
    .control-group{margin:1em 0;}
    .control-group label{display:inline-block;width:100px;text-align:right;margin-right:10px;}
    input[type="range"]{width:200px;}
    button{background:#2980b9;color:#fff;border:none;padding:10px 20px;border-radius:4px;cursor:pointer;margin:5px;transition:background .3s ease;}
    button:hover{background:#1976d2;}
    button:disabled{background:#bbb;cursor:not-allowed;}
    .demo-melody{background:#4caf50;}
    .demo-melody:hover{background:#388e3c;}
    .status{text-align:center;margin:1em 0;font-style:italic;color:#666;}
    .mobile-instruction{text-align:center;color:#666;font-size:.9em;margin-top:1em;}
    @media (min-width:769px){ .mobile-instruction{display:none;} }
    .dl { background:#fff;padding:1em 1.2em;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.06); }
    .dl a{ font-weight:bold; }
    .meta { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background:#fff; padding:1em; border-radius:8px; box-shadow:0 2px 8px rgba(0,0,0,.06); }
  </style>

  <!-- JSON-LD: å®šç¾©ï¼ˆDefinedTermï¼‰ -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "DefinedTerm",
    "name": "Iceface Tuning",
    "alternateName": ["ã‚¢ã‚¤ã‚¹ãƒ•ã‚§ã‚¤ã‚¹ãƒ»ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°", "Iceface Tuning (black keys +50c)"],
    "description": "12å¹³å‡å¾‹ã‚’åŸºã«é»’éµã®ã¿ã‚’+50ã‚»ãƒ³ãƒˆä¸Šã’ã‚‹ç‹¬è‡ªèª¿å¾‹ã€‚ç™½éµã§å®‰å®šã€é»’éµã§å¾®åˆ†éŸ³ã®å½©ã‚Šã‚’å¾—ã‚‹ã€‚",
    "inDefinedTermSet": "https://iceface-microtonal.github.io/",
    "url": "https://iceface-microtonal.github.io/",
    "additionalProperty": [
      {"@type":"PropertyValue","name":"octave","value":"1200 cents"},
      {"@type":"PropertyValue","name":"cents","value":"0,150,200,350,400,500,650,700,850,900,1050,1100,1200"}
    ]
    /* "sameAs": ["https://zenodo.org/record/XXXXX","https://github.com/â€¦"]  â† DOIç­‰ãŒã§ããŸã‚‰è¿½åŠ  */
  }
  </script>

  <!-- JSON-LD: FAQï¼ˆå®šç¾©ã‚¯ã‚¨ãƒªã‚’æ‹¾ã‚ã›ã‚‹ï¼‰ -->
  <script type="application/ld+json">
  {
    "@context":"https://schema.org",
    "@type":"FAQPage",
    "mainEntity":[
      {"@type":"Question","name":"Iceface Tuning ã¨ã¯ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"12å¹³å‡å¾‹ã‚’åŸºã«é»’éµã®ã¿ã‚’+50ã‚»ãƒ³ãƒˆä¸Šã’ã‚‹èª¿å¾‹ã§ã™ã€‚ç™½éµã¯é€šå¸¸ã®12å¹³å‡å¾‹ã€é»’éµã§å¾®åˆ†éŸ³çš„ãªå½©ã‚Šã‚’ä¸ãˆã¾ã™ã€‚"}},
      {"@type":"Question","name":"ã‚»ãƒ³ãƒˆå€¤ã¯ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"0,150,200,350,400,500,650,700,850,900,1050,1100,1200ï¼ˆã‚ªã‚¯ã‚¿ãƒ¼ãƒ–=1200cï¼‰ã€‚"}},
      {"@type":"Question","name":"ã©ã†ã‚„ã£ã¦ä½¿ã†ï¼Ÿ","acceptedAnswer":{"@type":"Answer","text":"Scalaã®.scl/.tunã€MTS-ESPå¯¾å¿œã‚·ãƒ³ã‚»ã§èª­ã¿è¾¼ã¿ã¾ã™ã€‚Surge XTã‚„Vitalç­‰ã§åˆ©ç”¨å¯èƒ½ã€‚"}}
    ]
  }
  </script>
</head>
<body>
  <h1>Iceface Tuning (black keys +50c)</h1>
  <p>å¾®åˆ†éŸ³ãƒ»GDCãƒ»AIã«ã‚ˆã‚‹å‰µä½œã‚’æ¢æ±‚ã™ã‚‹æ–°ã—ã„éŸ³ã®ä¸–ç•Œã¸ã‚ˆã†ã“ãã€‚</p>

  <div class="section">
    <h2>Iceface Tuningã¨ã¯</h2>
    <p>
      Iceface Tuning ã¯ã€æ—¥æœ¬ã®ä½œæ›²å®¶ H. Wakabayashi ã«ã‚ˆã£ã¦ææ¡ˆã•ã‚ŒãŸç‹¬è‡ªã®å¾®åˆ†éŸ³ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°ã§ã™ã€‚
      ãƒé•·èª¿ã‚’åŸºæº–ã¨ã—ãŸå ´åˆã€ã™ã¹ã¦ã®é»’éµï¼ˆã‚·ãƒ£ãƒ¼ãƒ—/ãƒ•ãƒ©ãƒƒãƒˆï¼‰ã‚’ç´„ <strong>+50 ã‚»ãƒ³ãƒˆ</strong>ï¼ˆå››åˆ†éŸ³ï¼‰ã¨ã—ã¾ã™ã€‚
      ç™½éµã¯é€šå¸¸ã®12å¹³å‡å¾‹ã®ã¾ã¾ãªã®ã§ã€ç›´æ„Ÿçš„ã«æ¼”å¥ã§ãã¾ã™ã€‚
    </p>
    <p>
      ã“ã‚Œã«ã‚ˆã‚Šã€æ—‹å¾‹ã‚„å’ŒéŸ³ã«å¯¾ã—ã¦å±€æ‰€çš„ãªãƒ‡ãƒãƒ¥ãƒ¼ãƒ³åŠ¹æœï¼ˆã‚³ãƒ¼ãƒ©ã‚¹æ„Ÿï¼‰ã‚„ãƒ€ãƒ–ãƒªãƒ³ã‚°çš„ãªåŠ¹æœãŒç”Ÿã¾ã‚Œã€
      12å¹³å‡å¾‹ã®ä¸­ã«è‡ªç„¶ã«å¾®åˆ†éŸ³ã‚’èåˆã•ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
    </p>

    <!-- ã‚»ãƒ³ãƒˆä¸€è¦§ï¼ˆæ©Ÿæ¢°æŠ½å‡ºã•ã‚Œã‚„ã™ã„å½¢ã§æ˜è¨˜ï¼‰ -->
    <div class="meta" aria-label="Cents list">
      <strong>Cents:</strong>
      0,150,200,350,400,500,650,700,850,900,1050,1100,1200
    </div>

    <p style="margin-top:1em;">
      æ´¾ç”Ÿã¨ã—ã¦ã€ŒIced Lydianã€ã€ŒIced Maqam Rastã€ãªã©ã®<span>ã‚¢ã‚¤ã‚¹åŒ–ãƒ¢ãƒ¼ãƒ‰</span>ã‚‚ã‚ã‚Šã€
      éè¥¿æ´‹éŸ³æ¥½ã«ã‚‚å¿œç”¨ãŒåºƒãŒã£ã¦ã„ã¾ã™ã€‚
    </p>
  </div>

  <!-- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å°ç·šï¼ˆå¾Œã§ãƒªãƒ³ã‚¯ã‚’å·®ã—æ›¿ãˆï¼‰ -->
  <div class="section dl">
    <h2>å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆDownloadï¼‰</h2>
    <p>Scala / MTS-ESP ãªã©ã§èª­ã¿è¾¼ã‚ã¾ã™ã€‚</p>
<ul>
  <li><a href="/Iceface_Tuning.scl" download>Iceface_Tuning.scl</a>ï¼ˆScalaï¼‰</li>
  <li><a href="/Iceface_Tuning.tun" download>Iceface_Tuning.tun</a>ï¼ˆAnaMark .tunï¼‰</li>
  <li><a href="/Iceface_Tuning_cents.txt" download>Iceface_Tuning_cents.txt</a></li>
  <li><a href="/Iceface_Tuning_v1.0.zip" download>Iceface_Tuning_v1.0.zip</a>ï¼ˆå…¨éƒ¨å…¥ã‚Šï¼‰</li>
</ul>
    <!-- DOI ãŒå–ã‚ŒãŸã‚‰è¡¨ç¤º -->
    <!-- <p>DOI: <a href="https://doi.org/10.5281/zenodo.XXXXX">10.5281/zenodo.XXXXX</a></p> -->
  </div>

  <!-- ä½“é¨“ãƒ‡ãƒ¢ï¼ˆæ—¢å­˜ï¼‰ -->
  <div class="section">
    <h2>Iceface Tuning ã‚’ä½“é¨“ã™ã‚‹</h2>
    <div class="piano-player">
      <div class="status" id="status">ã¾ãšã€ŒéŸ³å£°ã‚’æœ‰åŠ¹åŒ–ã€ãƒœã‚¿ãƒ³ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„ï¼ˆiPhoneå¿…é ˆï¼‰</div>

      <div class="controls">
        <div class="control-group">
          <button onclick="initAudio()" class="audio-init" id="initButton" style="background:#ff9800;font-size:18px;padding:15px 30px;">ğŸ”Š éŸ³å£°ã‚’æœ‰åŠ¹åŒ–ï¼ˆã‚¿ãƒƒãƒ—å¿…é ˆï¼‰</button>
        </div>
        <div class="control-group">
          <label>éŸ³é‡:</label>
          <input type="range" id="volume" min="0" max="100" value="30">
          <span id="volumeValue">30%</span>
        </div>
        <div class="control-group">
          <label>ã‚ªã‚¯ã‚¿ãƒ¼ãƒ–:</label>
          <input type="range" id="octave" min="3" max="6" value="4">
          <span id="octaveValue">4</span>
        </div>
        <div class="control-group">
          <button onclick="playDemoMelody()" class="demo-melody" disabled id="demoButton">ãƒ‡ãƒ¢ãƒ¡ãƒ­ãƒ‡ã‚£ã‚’å†ç”Ÿ</button>
          <button onclick="stopAll()" disabled id="stopButton">ã™ã¹ã¦åœæ­¢</button>
        </div>
      </div>

      <div class="piano-keyboard" id="keyboard"></div>

      <p style="text-align:center;color:#666;font-size:.9em;">
        <strong>é’ã„ã‚­ãƒ¼</strong>ãŒã‚¢ã‚¤ã‚¹ãƒ»ãƒãƒ¼ãƒˆï¼ˆ+50 ã‚»ãƒ³ãƒˆï¼‰ã§ã™ã€‚é€šå¸¸ã®é»’éµã¨è´ãæ¯”ã¹ã¦ãã ã•ã„ã€‚
      </p>
      <div class="mobile-instruction">ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã§ã¯éµç›¤ã‚’æ¨ªã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§ãã¾ã™ã€‚æ¨ªå‘ãã«ã™ã‚‹ã¨æ¼”å¥ã—ã‚„ã™ã„ã§ã™ã€‚</div>
    </div>
  </div>

  <div class="section">
    <h2>å¿œç”¨ä½¿ç”¨ä¾‹ã¨ã—ã¦ã®ãƒã‚«ãƒ¼ãƒ åŒ–ï¼ˆIceface Maqam Rastï¼‰</h2>
<pre>
C - C
Dâ™­ +50c (ice note)
D - D
E -ã€€E (ice note)
E -50c
F - F
Gâ™­ +50c (ice note)
G - G
Aâ™­ +50c (ice note)
A - A
B - B (ice note)
B -50c
</pre>
  </div>

  <div class="section">
    <h2>H. Wakabayashiã«ã¤ã„ã¦</h2>
    <p>H. Wakabayashi ã¯ä½œæ›²å®¶ãƒ»ã‚µã‚¦ãƒ³ãƒ‰ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆã€‚YouTubeã‚„SoundCloudã§ Iceface Tuning ã‚’ç”¨ã„ãŸä½œå“ã‚’å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚</p>
    <p>
      <a href="http://bit.ly/1TxRGAd" target="_blank" rel="noopener">â–¶ SoundCloudã§è´ã</a><br>
      <a href="http://mewomihi.tumblr.com/" target="_blank" rel="noopener">â–¶ Tumblrã®è¨˜äº‹ã‚’èª­ã‚€</a>
    </p>
  </div>

  <div class="section">
    <h2>ç‰¹å¾´ã¨å½±éŸ¿</h2>
    <ul>
      <li>Native Instruments Kontakt ã‚„ DAW ã® microtuning æ©Ÿèƒ½ã‚’æ´»ç”¨</li>
      <li>Sevish ã‚„Xenharmonicã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã‹ã‚‰æ³¨ç›®</li>
      <li>Lumatone ã‚’ç”¨ã„ãŸãƒ©ã‚¤ãƒ–æ¼”å¥</li>
      <li>å“²å­¦ãƒ»ãƒ¦ãƒ¼ãƒ¢ã‚¢ãƒ»æ•™è‚²çš„è¦–ç‚¹ã®ã‚ã‚‹éŸ³å¾‹è¨­è¨ˆ</li>
    </ul>
  </div>

  <div class="section">
    <h2>ä»Šå¾Œã®å±•æœ›</h2>
    <p>ã€ŒIce Tonalityã€ã‚„ã€ŒIceface Maqamã€ãªã©ã€AIã‚„GDCã¨é€£æºã—ãªãŒã‚‰æ–°ã—ã„éŸ³æ¥½ä¸–ç•Œã®é–‹æ‹“ã‚’é€²ã‚ã¦ã„ã¾ã™ã€‚</p>
  </div>

  <footer>
    &copy; 2025 H. Wakabayashi â€” Iceface Tuning Project. All rights reserved.
  </footer>

  <!-- Web Audio / Piano JSï¼ˆæ—¢å­˜ï¼‰ -->
  <script>
    let audioContext; let currentNotes = new Map(); let gainNode; let isAudioInitialized = false;
    const baseFrequencies = {'C':261.63,'C#':277.18,'D':293.66,'D#':311.13,'E':329.63,'F':349.23,'F#':369.99,'G':392.00,'G#':415.30,'A':440.00,'A#':466.16,'B':493.88};
    const centToRatio = (cents)=>Math.pow(2, cents/1200); const iceNoteRatio = centToRatio(50);

    function initAudio(){
      try{
        audioContext = new (window.AudioContext||window.webkitAudioContext)();
        gainNode = audioContext.createGain(); gainNode.connect(audioContext.destination);
        updateVolume(); isAudioInitialized = true;
        const osc = audioContext.createOscillator(); const tmp = audioContext.createGain();
        tmp.gain.setValueAtTime(0, audioContext.currentTime); osc.connect(tmp); tmp.connect(audioContext.destination);
        osc.start(); osc.stop(audioContext.currentTime+0.1);
        document.getElementById('demoButton').disabled=false;
        document.getElementById('stopButton').disabled=false;
        document.getElementById('initButton').style.display='none';
        document.getElementById('status').textContent='éµç›¤ã‚’ã‚¿ãƒƒãƒ—ã—ã¦éŸ³ã‚’å†ç”Ÿã§ãã¾ã™';
      }catch(e){
        console.error('Audio init failed', e);
        document.getElementById('status').textContent='ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã®åˆæœŸåŒ–ã«å¤±æ•—ã€‚Safariã‚’ãŠè©¦ã—ãã ã•ã„ã€‚';
      }
    }

    function generateKeyboard(){
      const keyboard=document.getElementById('keyboard');
      const keys=[{note:'C',type:'white',ice:false},{note:'C#',type:'black',ice:true},{note:'D',type:'white',ice:false},{note:'D#',type:'black',ice:true},{note:'E',type:'white',ice:false},{note:'F',type:'white',ice:false},{note:'F#',type:'black',ice:true},{note:'G',type:'white',ice:false},{note:'G#',type:'black',ice:true},{note:'A',type:'white',ice:false},{note:'A#',type:'black',ice:true},{note:'B',type:'white',ice:false}];
      keyboard.innerHTML='';
      keys.forEach(k=>{
        const key=document.createElement('div');
        key.className=`key ${k.type}${k.ice?' ice':''}`;
        key.textContent=k.note+(k.ice?' â„':''); key.dataset.note=k.note; key.dataset.ice=k.ice;
        key.addEventListener('mousedown',()=>playNote(k.note,k.ice));
        key.addEventListener('mouseup',()=>stopNote(k.note));
        key.addEventListener('mouseleave',()=>stopNote(k.note));
        key.addEventListener('touchstart',e=>{e.preventDefault(); playNote(k.note,k.ice); key.style.opacity='0.7';});
        key.addEventListener('touchend',e=>{e.preventDefault(); stopNote(k.note); key.style.opacity='1';});
        key.addEventListener('touchcancel',e=>{e.preventDefault(); stopNote(k.note); key.style.opacity='1';});
        keyboard.appendChild(key);
      });
    }

    function playNote(note,isIce=false){
      if(!isAudioInitialized){ document.getElementById('status').textContent='ã¾ãšã€ŒéŸ³å£°ã‚’æœ‰åŠ¹åŒ–ã€ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ãã ã•ã„'; return; }
      try{
        const octave=parseInt(document.getElementById('octave').value);
        const base=baseFrequencies[note]; const mult=Math.pow(2,octave-4);
        let freq=base*mult; if(isIce){ freq *= iceNoteRatio; }
        const osc=audioContext.createOscillator(); const ng=audioContext.createGain();
        osc.type='triangle'; osc.frequency.setValueAtTime(freq,audioContext.currentTime);
        ng.gain.setValueAtTime(0,audioContext.currentTime); ng.gain.linearRampToValueAtTime(0.1,audioContext.currentTime+0.05);
        osc.connect(ng); ng.connect(gainNode); osc.start();
        currentNotes.set(note,{oscillator:osc,gainNode:ng});
        const el=document.querySelector(`[data-note="${note}"]`); if(el){ el.classList.add('active'); }
      }catch(e){ console.error('playNote error',e); }
    }

    function stopNote(note){
      if(currentNotes.has(note)){
        const {oscillator, gainNode:ng}=currentNotes.get(note);
        ng.gain.linearRampToValueAtTime(0,audioContext.currentTime+0.1);
        setTimeout(()=>{ try{oscillator.stop();}catch(_){} },100);
        currentNotes.delete(note);
      }
      const el=document.querySelector(`[data-note="${note}"]`); if(el){ el.classList.remove('active'); }
    }

    function stopAll(){ currentNotes.forEach((_,n)=>stopNote(n)); }
    function updateVolume(){ const v=document.getElementById('volume').value/100; document.getElementById('volumeValue').textContent=document.getElementById('volume').value+'%'; if(gainNode){ gainNode.gain.setValueAtTime(v*0.3,audioContext.currentTime);} }
    function updateOctave(){ document.getElementById('octaveValue').textContent=document.getElementById('octave').value; }
    function playDemoMelody(){
      if(!isAudioInitialized){ document.getElementById('status').textContent='ã¾ãšéŸ³å£°ã‚’æœ‰åŠ¹åŒ–ã—ã¦ãã ã•ã„'; return; }
      const melody=[{note:'C',ice:false,duration:500},{note:'D#',ice:true,duration:500},{note:'E',ice:false,duration:500},{note:'F#',ice:true,duration:500},{note:'G',ice:false,duration:500},{note:'A#',ice:true,duration:500},{note:'B',ice:false,duration:500},{note:'C',ice:false,duration:1000}];
      let t=0; melody.forEach(m=>{ setTimeout(()=>{ playNote(m.note,m.ice); setTimeout(()=>stopNote(m.note),m.duration-50); }, t); t+=m.duration; });
    }

    document.getElementById('volume').addEventListener('input',updateVolume);
    document.getElementById('octave').addEventListener('input',updateOctave);
    document.addEventListener('keydown',e=>{
      const map={'a':'C','w':'C#','s':'D','e':'D#','d':'E','f':'F','t':'F#','g':'G','y':'G#','h':'A','u':'A#','j':'B'};
      const n=map[e.key.toLowerCase()]; if(n && !currentNotes.has(n)){ const ice=['C#','D#','F#','G#','A#'].includes(n); playNote(n,ice); }
    });
    document.addEventListener('keyup',e=>{
      const map={'a':'C','w':'C#','s':'D','e':'D#','d':'E','f':'F','t':'F#','g':'G','y':'G#','h':'A','u':'A#','j':'B'};
      const n=map[e.key.toLowerCase()]; if(n){ stopNote(n); }
    });
    document.addEventListener('DOMContentLoaded',()=>{
      generateKeyboard(); updateVolume(); updateOctave();
      if(window.innerWidth<=768){ document.getElementById('status').textContent='éµç›¤ã‚’ã‚¿ãƒƒãƒ—ã—ã¦éŸ³ã‚’å†ç”Ÿã§ãã¾ã™'; }
      else{ document.getElementById('status').textContent='ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰: A-S-D-F-G-H-Jï¼ˆç™½éµï¼‰ã€W-E-T-Y-Uï¼ˆã‚¢ã‚¤ã‚¹ï¼‰'; }
    });
  </script>
</body>
</html>
